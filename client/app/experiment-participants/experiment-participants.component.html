<div class="container">
  <div class="card">
    <mat-tab-group class="tab-group" (selectedTabChange)="onTabChanged($event)">
      <mat-tab label="Study Participants">
        <busy-overlay *ngIf="isLoadingParticipants" [scale]="0.5" [overlayClass]="'main'"></busy-overlay>
        <table class="table table-data">
          <thead>
            <tr>
              <th>Email</th>
              <th>Status</th>
              <th>Created</th>
              <th>Signed In</th>
              <th>User UID</th>
              <th></th>
            </tr>
          </thead>
          <tr class="hoverable singleline" *ngFor="let participant of participants let index = index" (mouseLeave)="selectedRowIndex = -1"
            (mouseOver)="selectedRowIndex = index">
            <td>{{participant.user.email}}</td>
            <td>
              <div class="tag tag-danger" *ngIf="participant.isDenied">Denied</div>
              <div class="tag tag-warning" *ngIf="!participant.isDenied && !participant.isConsentApproved">Invitation Pending</div>

            </td>
            <td>{{participant.user.accountCreationTime | date: 'MMM dd, yyyy'}}</td>
            <td>{{participant.user.accountLastSignInTime | date: 'MMM dd, yyyy'}}</td>

            <td>{{participant.user._id}}</td>
            <td class="button-cell">
              <div class="pull-right">
                <button mat-icon-button [matMenuTriggerFor]="menu">
                  <mat-icon class="material-icons">more_vert</mat-icon>
                </button>
                <mat-menu #menu="matMenu">
                  <button mat-menu-item *ngIf="!participant.isDenied && !participant.isConsentApproved" (click)="onDeleteParticipantClicked(participant._id, 'Cancel Invitation', 'Do you want to cancel the pending invitation to the user?')">
                    <span>Cancel Invitation</span>
                  </button>
                  <button mat-menu-item *ngIf="!participant.isDenied && 
                  participant.isConsentApproved" (click)="onDeleteParticipantClicked(participant._id, 'Exclude Participant', 'Do you want to exclude the participant from the experiment?')"></button>
                  <span *ngIf="!participant.isDenied && 
                    participant.isConsentApproved">Exclude Participant</span>
                </mat-menu>
              </div>
            </td>
          </tr>
        </table>
        <div class="card-block card-footer">

          <small *ngIf="participants== null" class="text-color-gray">Participants not loaded.</small>
          <small *ngIf="participants!= null && participants.length == 0" class="text-color-gray">No participants in server.</small>
          <small *ngIf="participants!= null && participants.length > 0" class="text-color-gray">Participants: {{participants.length}}</small>

        </div>
      </mat-tab>
      <mat-tab label="The OmniTrack User Pool">
        <busy-overlay *ngIf="isLoadingUserPool" [scale]="0.5" [overlayClass]="main"></busy-overlay>
        <table class="table table-data" (mouseleave)="selectedRowIndex = -1">
          <thead>
            <tr>
              <th>Email</th>
              <th>Status</th>
              <th>Demographic</th>
              <th>Created</th>
              <th>Signed In</th>
              <th>User UID</th>
              <th></th>
            </tr>
          </thead>
          <tr class="hoverable singleline" *ngFor="let user of userPool let index = index" (mouseleave)="selectedRowIndex = -1" (mouseover)="selectedRowIndex = index">
            <td>{{user.email}}</td>
            <td>
              <div *ngIf="extractParticipantFromthisExperiment(user)">
                <span *ngIf="hasPendingInvitationFromThisExperiment(user)" class="tag tag-warning">Invitation Pending</span>
                <span *ngIf="isParticipatingInThisExperiment(user)" class="tag tag-primary">In Experiment</span>

              </div>
              <div *ngIf="isParticipatingInAnotherExperiment(user)">
                <span class="tag tag-warning">In Other Experiments</span>
              </div>
            </td>
            <td>{{exractDemographics(user)}}</td>
            <td>{{user.accountCreationTime | date: 'MMM dd, yyyy'}}</td>
            <td>{{user.accountLastSignInTime | date: 'MMM dd, yyyy'}}</td>
            <td>{{user._id}}</td>
            <td class="button-cell">
              <div class="pull-right" [style.visibility]="selectedRowIndex != index? 'hidden' : 'inherit'">
                <button mat-icon-button [matMenuTriggerFor]="menu">
                  <mat-icon class="material-icons">more_vert</mat-icon>
                </button>
                <mat-menu #menu="matMenu">
                  <button mat-menu-item *ngIf="!hasPendingInvitationFromThisExperiment(user)" (click)="onSendInvitationClicked(user._id)">
                    <span>Invite</span>
                  </button>
                  <button mat-menu-item (click)="onDeleteAccountClicked(user._id)">
                    <span class="text-color-danger">Delete Account</span>
                  </button>
                </mat-menu>
              </div>
            </td>

          </tr>
        </table>

        <div class="card-block card-footer">

          <small *ngIf="userPool== null" class="text-color-gray">User pool not loaded.</small>
          <small *ngIf="userPool!= null && userPool.length == 0" class="text-color-gray">No users in server.</small>
          <small *ngIf="userPool!= null && userPool.length > 0" class="text-color-gray">Users: {{userPool.length}}</small>

        </div>
      </mat-tab>
    </mat-tab-group>

  </div>


</div>