<div class="container">
  <div class="card card-main">
    <mat-tab-group>
      <mat-tab [label]="p.platform" *ngFor="let p of supportedPlatforms; trackBy: matchPlatforms">
        <div class="card-body card-content">

          <app-labeled-loading-indicator *ngIf="p.isLoading===true" [fitParent]="p.originalConfig!=null">
            <span *ngIf="p.originalConfig==null" message>Loading platform configuration..</span>
            <span *ngIf="p.originalConfig!=null" message>Please wait..</span>

          </app-labeled-loading-indicator>
          <div class="alert alert-warning no-margin flex-container flex-align-items-center" role="alert" *ngIf="p.isLoading !== true && p.isInitialized === false">
            <span>
              A build configuration of this platform is not initialized. Do you want to initialize?
            </span>
            <div class="flex-filler"></div>
            <button mat-raised-button color="primary" (click)="onInitializeClicked(p)">Initialize</button>
          </div>
          <ng-container *ngIf="p.isLoading !== true && p.isInitialized === true && p.originalConfig != null">
            <div class="header flex-container flex-align-items-center">
              <div class="text-right text-color-lightgray saved-timestamp-indicator">
                Recently saved at: {{p.originalConfig.updatedAt | date: 'short'}}
              </div>
              <div class="flex-filler"></div>
              <button [disabled]="isConfigChanged(p.originalConfig, p.changedConfig) === false" mat-raised-button color="accent" (click)="onSaveClicked(p)">Save Changes</button>
            </div>
            <table class="table settings-main-table">
              <tr>
                <th class="main-settings-header">
                  Basic App Info
                </th>
                <td class="main-settings-container">
                  <app-config-variable-row label="App name" type="text" variableName="appName" hintText="Set app name to override 'OmniTrack'"
                    [config]="p.changedConfig" [originalValue]="p.originalConfig.appName"></app-config-variable-row>

                  <app-config-variable-row label="Package name" type="text" variableName="packageName" hintText="kr.ac.snu.hcil.omnitrack"
                    [config]="p.changedConfig" [originalValue]="p.originalConfig.packageName"></app-config-variable-row>
                </td>
              </tr>
              <tr>
                <th class="main-settings-header">
                  Functionality Locks
                </th>
                <td class="main-settings-container">
                  <app-config-variable-row label="Hide the external entities" type="boolean" variableName="disableExternalEntities" hintText="Disable using or adding trackers that are not assigned to this experiment."
                    [config]="p.changedConfig" [originalValue]="p.originalConfig.disableExternalEntities"></app-config-variable-row>

                  <app-config-variable-row label="Disable tracker creation" type="boolean" variableName="disableTrackerCreation" hintText="Disable participants to create their own trackers."
                    [config]="p.changedConfig" [originalValue]="p.originalConfig.disableTrackerCreation"></app-config-variable-row>

                  <app-config-variable-row label="Disable trigger creation" type="boolean" variableName="disableTriggerCreation" hintText="Disable participants to create their own triggers."
                    [config]="p.changedConfig" [originalValue]="p.originalConfig.disableTriggerCreation"></app-config-variable-row>

                  <app-config-variable-row label="Hide trigger list" type="boolean" variableName="hideTriggersTab" hintText="Disable an access to trigger list."
                    [config]="p.changedConfig" [originalValue]="p.originalConfig.hideTriggersTab"></app-config-variable-row>

                  <app-config-variable-row label="Hide service list" type="boolean" variableName="hideServicesTab" hintText="Disable an access to service list."
                    [config]="p.changedConfig" [originalValue]="p.originalConfig.hideServicesTab"></app-config-variable-row>

                  <app-config-variable-row label="Show tutorials" type="boolean" variableName="showTutorials" hintText="" [config]="p.changedConfig"
                    [originalValue]="p.originalConfig.showTutorials"></app-config-variable-row>
                </td>
              </tr>

              <ng-container [ngSwitch]="p.platform">
                <tr *ngSwitchCase="'Android'">
                  <th class="main-settings-header">
                    Android Build Settings
                  </th>
                  <td class="main-settings-container">
                    <app-config-variable-row label="google-services.json" [originalValue]="p.originalConfig.credentials.googleServices" [config]="p.changedConfig.credentials"
                      variableName="googleServices" type="jsonFile"></app-config-variable-row>

                    <app-config-variable-row label="Android keystore file (.jks)" [originalValue]="p.originalConfig.credentials.keystoreFileHash"
                      [config]="p.changedConfig.credentials" 
                      (binaryFileChanged)="p.localFiles.androidKeystore = $event"
                      variableName="keystoreFileHash" 
                      type="jksFile"></app-config-variable-row>

                    <app-config-variable-row label="Android keystore password" [originalValue]="p.originalConfig.credentials.keystorePassword"
                      [config]="p.changedConfig.credentials" hintText="Password for the keystore" variableName="keystorePassword" type="password"></app-config-variable-row>

                    <app-config-variable-row label="Android keypair alias" [originalValue]="p.originalConfig.credentials.keystoreAlias" [config]="p.changedConfig.credentials"
                    hintText="Alias of keypair to use"
                      variableName="keystoreAlias" type="text"></app-config-variable-row>


                    <app-config-variable-row label="Android keypair password" [originalValue]="p.originalConfig.credentials.keystoreKeyPassword"
                    hintText="Password for the designated keypair"
                      [config]="p.changedConfig.credentials" variableName="keystoreKeyPassword" type="password"></app-config-variable-row>
                  </td>
                </tr>
              </ng-container>
              <tr>
                <th class="main-settings-header">
                  Third-party service credentials
                </th>
                <td class="main-settings-container">
                  <app-config-variable-row label="App name"></app-config-variable-row>
                </td>
              </tr>
            </table>
          </ng-container>
        </div>
      </mat-tab>
    </mat-tab-group>
  </div>
</div>
